# HTTP to HTTPS redirect
  server {
      listen 80;
      listen [::]:80;
      server_name api.wealthwarriorshub.in;
      return 301 https://$server_name$request_uri;
  }

  # HTTPS server
  server {
      listen 443 ssl;
    http2 on;
      listen [::]:443 ssl;
      server_name api.wealthwarriorshub.in;

      # SSL Configuration
      ssl_certificate /etc/letsencrypt/live/api.wealthwarriorshub.in/fullchain.pem;
      ssl_certificate_key /etc/letsencrypt/live/api.wealthwarriorshub.in/privkey.pem;
      include /etc/letsencrypt/options-ssl-nginx.conf;
      ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

      # Security Headers
      add_header X-Frame-Options "SAMEORIGIN" always;
      add_header X-Content-Type-Options "nosniff" always;
      add_header X-XSS-Protection "1; mode=block" always;

      # Allow longer query strings
      large_client_header_buffers 4 32k;

      # Logging
      access_log /var/log/nginx/api.wealthwarriorshub.in.access.log;
      error_log /var/log/nginx/api.wealthwarriorshub.in.error.log;

      # WebSocket configuration
      location /ws/ {
          proxy_pass http://127.0.0.1:8000;
          proxy_http_version 1.1;
          proxy_set_header Upgrade $http_upgrade;
          proxy_set_header Connection "upgrade";
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
          proxy_read_timeout 86400s;
          proxy_send_timeout 86400s;
          proxy_connect_timeout 60s;
          proxy_buffering off;
      }

      # API endpoints
      location /api/ {
          proxy_pass http://127.0.0.1:8000;
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
          proxy_connect_timeout 120s;
          proxy_send_timeout 120s;
          proxy_read_timeout 120s;
      }

      # API documentation
      location /docs {
          proxy_pass http://127.0.0.1:8000;
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
      }

      location /openapi.json {
          proxy_pass http://127.0.0.1:8000;
          proxy_set_header Host $host;
      }

      location /redoc {
          proxy_pass http://127.0.0.1:8000;
          proxy_set_header Host $host;
      }

      # Health check
      location /health {
          proxy_pass http://127.0.0.1:8000/health;
          access_log off;
      }

      # Root
      location / {
          proxy_pass http://127.0.0.1:8000;
          # Add these lines
          proxy_connect_timeout 120s;
          proxy_send_timeout 120s;
          proxy_read_timeout 120s;
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
      }

      # Block exploits
      location ~ /\. {
          deny all;
          access_log off;
          log_not_found off;
      }
  }